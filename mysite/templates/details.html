<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Competition</a>
        <div class="d-flex align-items-center">
            {% if user.is_authenticated %}
            <form action="/logout/" method="POST" class="me-2">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Выйти</button>
            </form>
            <a href="{% url 'account' %}" class="me-3">
                <button class="btn btn-primary">Личный кабинет</button>
            </a>
            <div class="border-start ps-3 fs-5 text-success">
                {{ user.username }}
            </div>
            {% else %}
            <a href="{% url 'auth' %}" class="me-2">
                <button class="btn btn-primary">Войти</button>
            </a>
            <a href="{% url 'registration' %}">
                <button class="btn btn-secondary">Зарегистрироваться</button>
            </a>
            {% endif %}
        </div>
    </div>
</nav>

<img src="{{ photo.image.url }}" class="rounded mx-auto d-block">
<p class="text-center">{{ photo.description }}</p>
<p class="text-center">Автор: {{photo.author}}</p>
<p class="text-center">Загружено: {{photo.publication_date}}</p>
<br>
<form method="POST" class="text-center mt-3">
    {% csrf_token %}
    {% if is_liked %}
    <button type="submit" class="btn btn-primary" name="like">Убрать лайк</button>
    {% else %}
    <button type="submit" class="btn btn-primary" name="like">Лайк</button>
    {% endif %}
</form>
<p class="text-center mt-2">
    Всего лайков: {{ photo.likes.count }}
</p>

<!-- комментарии -->
<div class="container mt-3">
    <div class="d-flex flex-column align-items-center">
        <div>
            <form method="POST">
                {% csrf_token %}
                {% if has_commented %}
                <div class="d-grid gap-2 d-md-block">
                    <button class="btn btn-secondary" type="submit" name="comment" value="delete">Удалить</button>
                    <button class="btn btn-danger" type="submit" name="comment" value="edit">Редактировать</button>
                </div>
                {% else %}
                <textarea id="text_input" name="comment_text" rows="5" cols="80"></textarea>
                <button id="send_btn" type="submit" class="btn btn-success w-50 mx-auto d-block" name="comment"
                        value="save" disabled>Отправить
                </button>
                {% endif %}
            </form>
        </div>
        <div class="d-flex flex-column align-items-start">
            {% for comment in comments %}
            <div class="card mb-1 mt-2">
                <div class="card-body">
                    <h6 class="card-subtitle mb-1 text-muted">{{comment.author}} | {{comment.comment_date}}</h6>
                    <p class="card-text">{{comment.text}}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<script>
    const input = document.getElementById('text_input');
    const btn = document.getElementById('send_btn');

    input.addEventListener('input', () => {
        const hasText = input.value.trim().length > 0;
        btn.disabled = !hasText;
    });
</script>
</body>
</html>
